@import 'utilities';



//
// Splits the given fraction string into two parts and returnx
// them as a map
// @param  {String} $fraction The fraction string like '1/2'
// @return {Object}           A map with counter and denominator
//                            would be returned, if valid fraction
//                            is given. Otherwise null.
//
@function _explodeFraction ($fraction) {
    $delimiterPos: str-index($fraction, '/');
    $result: null;

    @if($delimiterPos) {
        $length: str-length($fraction);

        // Gets the counter of the fraction - 1/2
        //                                    ^
        $counter: str-slice($fraction, 1, $delimiterPos);

        // Gets the denominator of the fraction - 1/2
        //                                          ^
        $denominator: str-slice($fraction, ($delimiterPos + 1), $length);

        $result: (_toNumber($counter), _toNumber($denominator));
    }

    @return $result;
}



//
// Transform a fraction map to percent representation
// @param  {String} $fraction The fraction map like (1, 2)
// @return {Number}           Percent representation of the given
//                            fraction. Default is 100%.
//
@function _fractionToPercent ($fraction) {
    // Split fraction into map e.g. 1/2 -> (1, 2)
    $fractionMap: _explodeFraction($fraction);

    // Default width
    $result: 100;

    @if($fractionMap) {
        $counter:     nth($fractionMap, 1);
        $denominator: nth($fractionMap, 2);

        // Fraction in percentage e.g. 1/2 -> 50
        $calcedValue: ((100 / $denominator) * $counter);

        @if($hill-layout-boxes-space > 0) {
            // Spaces between boxes.
            // E.g. 3 possible spaces between 4 boxes,
            // because last space is not needed
            $spaceCount: $denominator - 1;

            // Calculate the correct space size, that we can combine
            // box size with space size to get always 100% total width.
            $spaceSize: (($hill-layout-boxes-space * $spaceCount) / $denominator);
            $result:    #{$calcedValue - $spaceSize};
        } @else {
            $result: #{$calcedValue};
        }
    }

    @return #{$result}%;
}



//
// Added to reduce css output
//
%_floatLeft {
    float: left;
}

%_clearfix {
    &:before,
    &:after {
        content: " ";
        display: table;
    }
    &:after {
        clear: both;
    }
}



//
// Generates box width and box min/max css attributes
//
@each $width in $hill-layout-boxes {
    // -> box-1/2, box-1/3 ...
    @if ($hill-layout-css-general) {
        [#{$hill-layout-attribute-name}*="box-#{$width}"] {
            width: _fractionToPercent($width);
        }
    }

    // -> min-1/2, max-1/2 ...
    @if($hill-layout-css-min-max) {
        [#{$hill-layout-attribute-name}*="min-#{$width}"] {
            min-width: _fractionToPercent($width);
        }

        [#{$hill-layout-attribute-name}*="max-#{$width}"] {
            max-width: _fractionToPercent($width);
        }
    }
}



//
// Generates space for all boxes
//
@if ($hill-layout-css-general or $hill-layout-css-breakpoints) {
    @if(stripUnit($hill-layout-boxes-space) > 0) {
        [#{$hill-layout-attribute-name}*="box-"] {
            &:not(:last-child) {
                margin-right: #{$hill-layout-boxes-space};
            }
        }
    }
}



//
// Generates box row to float boxes inside
//
@if ($hill-layout-css-general) {
    [#{$hill-layout-attribute-name}*="row"]  {
        & > [#{$hill-layout-attribute-name}*="box-"] {
            @extend %_floatLeft;
        }

        @extend %_clearfix;
    }
}



//
// Generates box breakpoints with relevant width sizes
//
@if ($hill-layout-css-breakpoints) {
    @each $breakpoint in $hill-layout-breakpoints {
        $breakpointName: nth($breakpoint, 1);

        // -> box-small-1/2, box-medium-1/2 ...
        @each $width in $hill-layout-boxes {
            @include deviceIs ($breakpointName) {
                [#{$hill-layout-attribute-name}*="box-#{$breakpointName}-#{$width}"] {
                    width: _fractionToPercent($width);;

                    // Tried to exclude this into a placeholder. But this after that
                    // this selector is not rendered inside a media query condition
                    display: block;
                }
            };
        }

        // -> box-small-hide
        @include deviceIs ($breakpointName) {
            [#{$hill-layout-attribute-name}*="box-#{$breakpointName}-hide"] {
                // Tried to exclude this into a placeholder. But this after that
                // this selector is not rendered inside a media query condition
                display: none;
            }
        }
    }
}



//
// Generates different layout helpers
//
@if ($hill-layout-css-helpers) {
    @for $index from 1 through $hill-layout-space-multiplier {
        @if $index > 1 {
            $multiplier: "-#{$index}x";
        } @else {
            $multiplier: '';
        }

        [#{$hill-layout-attribute-name}*="space-top#{$multiplier}"]       { margin-top:    #{$hill-layout-space * $index}; }
        [#{$hill-layout-attribute-name}*="space-right#{$multiplier}"]     { margin-right:  #{$hill-layout-space * $index}; }
        [#{$hill-layout-attribute-name}*="space-bottom#{$multiplier}"]    { margin-bottom: #{$hill-layout-space * $index}; }
        [#{$hill-layout-attribute-name}*="space-left#{$multiplier}"]      { margin-left:   #{$hill-layout-space * $index}; }
    }

    [#{$hill-layout-attribute-name}*="float-left"]     { @extend  %_floatLeft; }
    [#{$hill-layout-attribute-name}*="float-right"]    { float:   right; }
    [#{$hill-layout-attribute-name}*="hide"]           { display: none; }
    [#{$hill-layout-attribute-name}*="clear"]          { @extend  %_clearfix; }
}
